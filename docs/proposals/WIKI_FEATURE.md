# Wikiæ©Ÿèƒ½ä»•æ§˜æ›¸ï¼ˆè‰æ¡ˆï¼‰

> âš ï¸ **æ³¨æ„:** ã“ã®ä»•æ§˜ã¯ã¾ã ç¢ºå®šã—ã¦ã„ã¾ã›ã‚“ã€‚å®Ÿè£…å‰ã«è¦ä»¶ã‚’å†ç¢ºèªã—ã¦ãã ã•ã„ã€‚

**ä½œæˆæ—¥:** 2025-10-23
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:** ğŸ”¶ Draftï¼ˆè‰æ¡ˆï¼‰
**æƒ³å®šå®Ÿè£…æ™‚æœŸ:** æœªå®š

---

## æ¦‚è¦

çµ„ç¹”å†…ã§ã®çŸ¥è­˜å…±æœ‰ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç®¡ç†ã‚’æ”¯æ´ã™ã‚‹Wikiæ©Ÿèƒ½ã®ä»•æ§˜æ›¸ã€‚
ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆSaaSã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«çµ±åˆã—ã€çµ„ç¹”ã”ã¨ã«å®Œå…¨ã«åˆ†é›¢ã•ã‚ŒãŸWikiã‚’æä¾›ã™ã‚‹ã€‚

## ã‚¹ã‚³ãƒ¼ãƒ—

### âœ… å«ã¾ã‚Œã‚‹ã‚‚ã®
- ãƒšãƒ¼ã‚¸ä½œæˆãƒ»ç·¨é›†ï¼ˆMarkdownå½¢å¼ï¼‰
- éšå±¤æ§‹é€ ã«ã‚ˆã‚‹ãƒšãƒ¼ã‚¸ç®¡ç†
- PostgreSQLå…¨æ–‡æ¤œç´¢æ©Ÿèƒ½
- R2ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã‚ˆã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
- æ¨©é™ãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ï¼ˆç·¨é›†å±¥æ­´ï¼‰

### âŒ å«ã¾ã‚Œãªã„ã‚‚ã®
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½ï¼ˆWebSocketç­‰ï¼‰
- ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–ï¼ˆåŸºæœ¬çš„ãªãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ã®ã¿ï¼‰
- å¤–éƒ¨APIé€£æº
- é«˜åº¦ãªæ¨©é™ç®¡ç†ï¼ˆå°†æ¥ã®æ‹¡å¼µï¼‰

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³
- **PostgreSQLå…¨æ–‡æ¤œç´¢**ã‚’ä½¿ç”¨
- `tsvector`ã¨`tsquery`ã‚’æ´»ç”¨ã—ãŸé«˜é€Ÿæ¤œç´¢
- æ—¥æœ¬èªå¯¾å¿œã®ãŸã‚`pg_trgm`æ‹¡å¼µæ©Ÿèƒ½ã‚‚æ¤œè¨

### ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
- **R2ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**ã‚’æ´»ç”¨ï¼ˆæ—¢å­˜ã®å®Ÿè£…ã‚’æµç”¨ï¼‰
- ç”»åƒãƒ»æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- ç½²åä»˜ãURLã«ã‚ˆã‚‹å®‰å…¨ãªãƒ•ã‚¡ã‚¤ãƒ«é…ä¿¡

### ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½
- **ä¸è¦** - ã‚·ãƒ³ãƒ—ãƒ«ãªWikiæ©Ÿèƒ½ã«é›†ä¸­
- å°†æ¥çš„ã«å¿…è¦ã«ãªã£ãŸå ´åˆã¯WebSocketã§å¯¾å¿œ

### ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ
- **å¾Œå›ã—** - ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã§å®Ÿè£…
- åŸºæœ¬çš„ãªãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ã¯å®Ÿè£…

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ 

```sql
-- Wikiãƒšãƒ¼ã‚¸ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå…¨æ–‡æ¤œç´¢å¯¾å¿œï¼‰
CREATE TABLE wiki_pages (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    organization_id UUID NOT NULL REFERENCES organizations(id) ON DELETE CASCADE,
    
    -- åŸºæœ¬æƒ…å ±
    title TEXT NOT NULL,
    slug TEXT NOT NULL,
    content TEXT NOT NULL,
    summary TEXT,
    
    -- éšå±¤æ§‹é€ 
    parent_id UUID REFERENCES wiki_pages(id) ON DELETE CASCADE,
    path TEXT NOT NULL,
    depth INTEGER NOT NULL DEFAULT 0,
    
    -- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
    is_published BOOLEAN NOT NULL DEFAULT true,
    is_featured BOOLEAN NOT NULL DEFAULT false,
    view_count INTEGER NOT NULL DEFAULT 0,
    
    -- å…¨æ–‡æ¤œç´¢ç”¨ï¼ˆPostgreSQLï¼‰
    search_vector tsvector,
    
    -- ä½œæˆè€…ãƒ»æ›´æ–°è€…
    created_by UUID NOT NULL REFERENCES profiles(id),
    updated_by UUID NOT NULL REFERENCES profiles(id),
    
    -- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    
    -- åˆ¶ç´„
    UNIQUE(organization_id, slug),
    UNIQUE(organization_id, path)
);

-- å…¨æ–‡æ¤œç´¢ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_wiki_pages_search_vector ON wiki_pages USING gin(search_vector);
CREATE INDEX idx_wiki_pages_org_id ON wiki_pages(organization_id);
CREATE INDEX idx_wiki_pages_parent_id ON wiki_pages(parent_id);
CREATE INDEX idx_wiki_pages_path ON wiki_pages(organization_id, path);
CREATE INDEX idx_wiki_pages_slug ON wiki_pages(organization_id, slug);

-- æ¤œç´¢ãƒ™ã‚¯ã‚¿ãƒ¼ã‚’è‡ªå‹•æ›´æ–°ã™ã‚‹ãƒˆãƒªã‚¬ãƒ¼
CREATE OR REPLACE FUNCTION update_wiki_page_search_vector()
RETURNS TRIGGER AS $$
BEGIN
    NEW.search_vector = 
        setweight(to_tsvector('japanese', COALESCE(NEW.title, '')), 'A') ||
        setweight(to_tsvector('japanese', COALESCE(NEW.content, '')), 'B') ||
        setweight(to_tsvector('japanese', COALESCE(NEW.summary, '')), 'C');
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_wiki_pages_search_vector
    BEFORE INSERT OR UPDATE ON wiki_pages
    FOR EACH ROW EXECUTE FUNCTION update_wiki_page_search_vector();

-- Wikiæ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆR2ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å¯¾å¿œï¼‰
CREATE TABLE wiki_attachments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    page_id UUID NOT NULL REFERENCES wiki_pages(id) ON DELETE CASCADE,
    organization_id UUID NOT NULL REFERENCES organizations(id) ON DELETE CASCADE,
    
    -- ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±
    filename TEXT NOT NULL,
    original_filename TEXT NOT NULL,
    file_size INTEGER NOT NULL,
    content_type TEXT NOT NULL,
    
    -- R2ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æƒ…å ±
    r2_key TEXT NOT NULL, -- R2ã§ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚­ãƒ¼
    r2_url TEXT, -- å…¬é–‹URLï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    
    -- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
    description TEXT,
    is_image BOOLEAN NOT NULL DEFAULT false,
    
    -- ä½œæˆè€…
    uploaded_by UUID NOT NULL REFERENCES profiles(id),
    
    -- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_wiki_attachments_page_id ON wiki_attachments(page_id);
CREATE INDEX idx_wiki_attachments_org_id ON wiki_attachments(organization_id);

-- Wikiãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆå±¥æ­´ç®¡ç†ï¼‰
CREATE TABLE wiki_page_versions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    page_id UUID NOT NULL REFERENCES wiki_pages(id) ON DELETE CASCADE,
    
    -- ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±
    version_number INTEGER NOT NULL,
    title TEXT NOT NULL,
    content TEXT NOT NULL,
    summary TEXT,
    
    -- å¤‰æ›´æƒ…å ±
    change_reason TEXT, -- å¤‰æ›´ç†ç”±
    changed_by UUID NOT NULL REFERENCES profiles(id),
    
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    
    UNIQUE(page_id, version_number)
);

-- Wikiã‚³ãƒ¡ãƒ³ãƒˆ
CREATE TABLE wiki_comments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    page_id UUID NOT NULL REFERENCES wiki_pages(id) ON DELETE CASCADE,
    organization_id UUID NOT NULL REFERENCES organizations(id) ON DELETE CASCADE,
    
    -- ã‚³ãƒ¡ãƒ³ãƒˆå†…å®¹
    content TEXT NOT NULL,
    is_resolved BOOLEAN NOT NULL DEFAULT false,
    
    -- ä½œæˆè€…
    created_by UUID NOT NULL REFERENCES profiles(id),
    
    -- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_wiki_page_versions_page_id ON wiki_page_versions(page_id);
CREATE INDEX idx_wiki_comments_page_id ON wiki_comments(page_id);
```

### RLSãƒãƒªã‚·ãƒ¼

```sql
-- Wikiãƒšãƒ¼ã‚¸ã®RLSãƒãƒªã‚·ãƒ¼
CREATE POLICY "Users can view wiki pages in their organization" ON wiki_pages
    FOR SELECT USING (
        organization_id IN (
            SELECT organization_id FROM organization_members 
            WHERE user_id = auth.uid() AND deleted_at IS NULL
        )
    );

CREATE POLICY "Users can create wiki pages in their organization" ON wiki_pages
    FOR INSERT WITH CHECK (
        organization_id IN (
            SELECT organization_id FROM organization_members 
            WHERE user_id = auth.uid() AND deleted_at IS NULL
        )
    );

CREATE POLICY "Users can update their own wiki pages or admin can update any" ON wiki_pages
    FOR UPDATE USING (
        created_by = auth.uid() OR
        organization_id IN (
            SELECT organization_id FROM organization_members 
            WHERE user_id = auth.uid() AND role IN ('owner', 'admin') AND deleted_at IS NULL
        )
    );

CREATE POLICY "Admins can delete any wiki page" ON wiki_pages
    FOR DELETE USING (
        organization_id IN (
            SELECT organization_id FROM organization_members 
            WHERE user_id = auth.uid() AND role IN ('owner', 'admin') AND deleted_at IS NULL
        )
    );
```

### å…¨æ–‡æ¤œç´¢ç”¨ã®RPCé–¢æ•°

```sql
-- Wikiãƒšãƒ¼ã‚¸ã®å…¨æ–‡æ¤œç´¢é–¢æ•°
CREATE OR REPLACE FUNCTION search_wiki_pages(
    org_id UUID,
    search_query TEXT,
    limit_count INTEGER DEFAULT 20,
    offset_count INTEGER DEFAULT 0
)
RETURNS TABLE (
    id UUID,
    title TEXT,
    slug TEXT,
    summary TEXT,
    path TEXT,
    rank REAL,
    created_at TIMESTAMP WITH TIME ZONE,
    updated_at TIMESTAMP WITH TIME ZONE,
    created_by UUID,
    updated_by UUID
) AS $$
BEGIN
    RETURN QUERY
    SELECT 
        wp.id,
        wp.title,
        wp.slug,
        wp.summary,
        wp.path,
        ts_rank(wp.search_vector, plainto_tsquery('japanese', search_query)) as rank,
        wp.created_at,
        wp.updated_at,
        wp.created_by,
        wp.updated_by
    FROM wiki_pages wp
    WHERE wp.organization_id = org_id
        AND wp.is_published = true
        AND wp.search_vector @@ plainto_tsquery('japanese', search_query)
    ORDER BY rank DESC, wp.updated_at DESC
    LIMIT limit_count OFFSET offset_count;
END;
$$ LANGUAGE plpgsql;
```

## æ¨©é™ç®¡ç†

### é–²è¦§æ¨©é™
- çµ„ç¹”ãƒ¡ãƒ³ãƒãƒ¼å…¨å“¡ãŒé–²è¦§å¯èƒ½

### ç·¨é›†æ¨©é™
- `owner`/`admin`: å…¨ãƒšãƒ¼ã‚¸ã®ç·¨é›†ãƒ»å‰Šé™¤å¯èƒ½
- `member`: è‡ªåˆ†ãŒä½œæˆã—ãŸãƒšãƒ¼ã‚¸ã®ã¿ç·¨é›†å¯èƒ½

### ç®¡ç†æ¨©é™
- `owner`/`admin`ã®ã¿ãŒãƒšãƒ¼ã‚¸å‰Šé™¤ãƒ»æ¨©é™å¤‰æ›´å¯èƒ½

## UIè¨­è¨ˆ

### ã‚¨ãƒ‡ã‚£ã‚¿æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- **Monacoã‚¨ãƒ‡ã‚£ã‚¿**: VS Codeã¨åŒã˜ã‚¨ãƒ‡ã‚£ã‚¿ã‚¨ãƒ³ã‚¸ãƒ³
  - ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆ
  - è‡ªå‹•è£œå®Œ
  - æ¤œç´¢ãƒ»ç½®æ›
  - æŠ˜ã‚ŠãŸãŸã¿
  - ãƒãƒ«ãƒã‚«ãƒ¼ã‚½ãƒ«
  - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼

### ãƒšãƒ¼ã‚¸æ§‹é€ 
```
/app/wiki/
â”œâ”€â”€ /                    # Wikiãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸
â”œâ”€â”€ /[slug]             # å€‹åˆ¥ãƒšãƒ¼ã‚¸è¡¨ç¤º
â”œâ”€â”€ /[slug]/edit        # ãƒšãƒ¼ã‚¸ç·¨é›†
â”œâ”€â”€ /[slug]/history     # ç·¨é›†å±¥æ­´
â”œâ”€â”€ /create            # æ–°è¦ãƒšãƒ¼ã‚¸ä½œæˆ
â”œâ”€â”€ /search            # æ¤œç´¢çµæœ
â””â”€â”€ /settings          # Wikiè¨­å®šï¼ˆç®¡ç†è€…ã®ã¿ï¼‰
```

### ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- **WikiLayout**: ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ããƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- **WikiPageList**: ãƒšãƒ¼ã‚¸ä¸€è¦§è¡¨ç¤ºï¼ˆéšå±¤æ§‹é€ ï¼‰
- **WikiEditor**: Markdownã‚¨ãƒ‡ã‚£ã‚¿ï¼ˆMonacoã‚¨ãƒ‡ã‚£ã‚¿ + ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰
- **WikiSearch**: å…¨æ–‡æ¤œç´¢æ©Ÿèƒ½
- **WikiComments**: ã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½

## Server Actions

### ä¸»è¦ãªServer Actions

```typescript
// src/app/actions/wiki.ts

export async function createWikiPage(data: CreateWikiPageData)
export async function updateWikiPage(id: string, data: UpdateWikiPageData)
export async function deleteWikiPage(id: string)
export async function getWikiPage(slug: string)
export async function getWikiPageList(parentId?: string)
export async function searchWikiPages(query: string)
export async function createWikiComment(pageId: string, content: string)
export async function getWikiPageHistory(pageId: string)
export async function uploadWikiAttachment(pageId: string, file: File, description?: string)
export async function getImageUrl(attachmentId: string)
```

## R2ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸çµ±åˆ

### ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½

```typescript
// src/app/actions/wiki.ts
import { uploadFile, generatePresignedUploadUrl } from '@/lib/r2/operations'

export async function uploadWikiAttachment(
  pageId: string,
  file: File,
  description?: string
) {
  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()
  
  if (!user) {
    return { error: 'Unauthorized' }
  }

  // ç¾åœ¨ã®çµ„ç¹”ã‚’å–å¾—
  const orgId = await getCurrentOrganizationId()
  if (!orgId) {
    return { error: 'No organization selected' }
  }

  // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™ï¼ˆ10MBï¼‰
  if (file.size > 10 * 1024 * 1024) {
    return { error: 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã¾ã™ï¼ˆæœ€å¤§10MBï¼‰' }
  }

  // è¨±å¯ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—
  const allowedTypes = [
    'image/jpeg', 'image/png', 'image/gif', 'image/webp',
    'application/pdf', 'text/plain', 'application/msword',
    'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
  ]
  
  if (!allowedTypes.includes(file.type)) {
    return { error: 'ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ã§ã™' }
  }

  try {
    // R2ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
    const fileBuffer = Buffer.from(await file.arrayBuffer())
    const r2Key = `wiki/${orgId}/${pageId}/${Date.now()}-${file.name}`
    
    const { key, url } = await uploadFile(r2Key, fileBuffer, {
      contentType: file.type,
      metadata: {
        'original-filename': file.name,
        'uploaded-by': user.id,
        'page-id': pageId
      }
    })

    // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«è¨˜éŒ²
    const { data, error } = await supabase
      .from('wiki_attachments')
      .insert({
        page_id: pageId,
        organization_id: orgId,
        filename: file.name,
        original_filename: file.name,
        file_size: file.size,
        content_type: file.type,
        r2_key: key,
        r2_url: url,
        description,
        is_image: file.type.startsWith('image/'),
        uploaded_by: user.id
      })
      .select()
      .single()

    if (error) throw error

    return { success: true, attachment: data }
  } catch (error) {
    console.error('[uploadWikiAttachment]', error)
    return { error: 'ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ' }
  }
}
```

### ç”»åƒè¡¨ç¤ºç”¨ã®ç½²åä»˜ãURL

```typescript
// ç”»åƒè¡¨ç¤ºç”¨ã®ç½²åä»˜ãURLã‚’ç”Ÿæˆ
export async function getImageUrl(attachmentId: string) {
  const supabase = await createClient()
  
  // æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’å–å¾—
  const { data: attachment } = await supabase
    .from('wiki_attachments')
    .select('r2_key, content_type')
    .eq('id', attachmentId)
    .single()

  if (!attachment) {
    return { error: 'Attachment not found' }
  }

  // ç½²åä»˜ãURLã‚’ç”Ÿæˆï¼ˆ1æ™‚é–“æœ‰åŠ¹ï¼‰
  const signedUrl = await generatePresignedUrl(attachment.r2_key, 3600)
  
  return { success: true, url: signedUrl }
}
```

## å®Ÿè£…è¨ˆç”»

### Phase 1: åŸºæœ¬æ©Ÿèƒ½ï¼ˆæ¨å®š6-8æ™‚é–“ï¼‰
1. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒä½œæˆ**ï¼ˆ2æ™‚é–“ï¼‰
   - ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
   - å…¨æ–‡æ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­å®š
   - RLSãƒãƒªã‚·ãƒ¼è¨­å®š

2. **åŸºæœ¬CRUDæ“ä½œ**ï¼ˆ3æ™‚é–“ï¼‰
   - ãƒšãƒ¼ã‚¸ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤
   - éšå±¤æ§‹é€ ã®å®Ÿè£…
   - æ¨©é™ãƒã‚§ãƒƒã‚¯

3. **æ¤œç´¢æ©Ÿèƒ½**ï¼ˆ2æ™‚é–“ï¼‰
   - PostgreSQLå…¨æ–‡æ¤œç´¢ã®å®Ÿè£…
   - æ¤œç´¢çµæœã®è¡¨ç¤º

4. **ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**ï¼ˆ1æ™‚é–“ï¼‰
   - R2ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸çµ±åˆ
   - ç”»åƒè¡¨ç¤ºæ©Ÿèƒ½

### Phase 2: UI/UXï¼ˆæ¨å®š4-6æ™‚é–“ï¼‰
1. **Wikiãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ**ï¼ˆ2æ™‚é–“ï¼‰
   - ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
   - éšå±¤è¡¨ç¤º

2. **ã‚¨ãƒ‡ã‚£ã‚¿æ©Ÿèƒ½**ï¼ˆ2æ™‚é–“ï¼‰
   - Markdownã‚¨ãƒ‡ã‚£ã‚¿
   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼

3. **æ¤œç´¢UI**ï¼ˆ1æ™‚é–“ï¼‰
   - æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ 
   - çµæœè¡¨ç¤º

4. **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ**ï¼ˆ1æ™‚é–“ï¼‰
   - åŸºæœ¬çš„ãªãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ

## æŠ€è¡“çš„è€ƒæ…®äº‹é …

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- å…¨æ–‡æ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®æœ€é©åŒ–
- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…
- ç”»åƒã®é…å»¶èª­ã¿è¾¼ã¿

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- XSSå¯¾ç­–ï¼ˆMarkdownã‚µãƒ‹ã‚¿ã‚¤ã‚ºï¼‰
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰åˆ¶é™
- çµ„ç¹”é–“ã®å®Œå…¨åˆ†é›¢

### å°†æ¥ã®æ‹¡å¼µæ€§
- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã®åŸºç›¤
- APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®æº–å‚™
- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ©Ÿèƒ½ã®æ‹¡å¼µ

## æœªè§£æ±ºäº‹é …

### 1. Markdownã‚¨ãƒ‡ã‚£ã‚¿ã®é¸æŠ
- Monaco Editor vs CodeMirror vs ç‹¬è‡ªå®Ÿè£…
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®å®Ÿè£…æ–¹æ³•

### 2. æ¤œç´¢æ©Ÿèƒ½ã®è©³ç´°
- æ—¥æœ¬èªæ¤œç´¢ã®ç²¾åº¦å‘ä¸Š
- æ¤œç´¢çµæœã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

### 3. ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
- ç”»åƒã®æœ€é©åŒ–ï¼ˆãƒªã‚µã‚¤ã‚ºã€åœ§ç¸®ï¼‰
- ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†

### 4. æ¨©é™ã®ç´°åˆ†åŒ–
- ãƒšãƒ¼ã‚¸å˜ä½ã®æ¨©é™è¨­å®š
- ã‚³ãƒ¡ãƒ³ãƒˆæ¨©é™ã®ç®¡ç†

## å®Ÿè£…è¦‹ç©ã‚‚ã‚Š

| é …ç›® | æ™‚é–“ | è©³ç´° |
|------|------|------|
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ | 2æ™‚é–“ | ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã€RLSãƒãƒªã‚·ãƒ¼ |
| åŸºæœ¬CRUDæ“ä½œ | 3æ™‚é–“ | Server Actionsã€æ¨©é™ãƒã‚§ãƒƒã‚¯ã€éšå±¤æ§‹é€  |
| æ¤œç´¢æ©Ÿèƒ½ | 2æ™‚é–“ | PostgreSQLå…¨æ–‡æ¤œç´¢ã€RPCé–¢æ•°ã€UI |
| ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç† | 1æ™‚é–“ | R2ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸çµ±åˆã€ç”»åƒè¡¨ç¤º |
| Wikiãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ | 2æ™‚é–“ | ã‚µã‚¤ãƒ‰ãƒãƒ¼ã€éšå±¤è¡¨ç¤ºã€ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ |
| ã‚¨ãƒ‡ã‚£ã‚¿æ©Ÿèƒ½ | 2æ™‚é–“ | Markdownã‚¨ãƒ‡ã‚£ã‚¿ã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ |
| æ¤œç´¢UI | 1æ™‚é–“ | æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ã€çµæœè¡¨ç¤º |
| ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ | 1æ™‚é–“ | åŸºæœ¬çš„ãªãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ |
| **åˆè¨ˆ** | **14æ™‚é–“** | **â­â­â­ å¤§è¦æ¨¡ï¼ˆæ®µéšçš„å®Ÿè£…æ¨å¥¨ï¼‰** |

## å‚è€ƒè³‡æ–™

- æ—¢å­˜å®Ÿè£…: `src/lib/r2/` - R2ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ: `docs/specifications/DATABASE_SCHEMA.md`
- æ¨©é™ç®¡ç†: `src/lib/auth/permissions.ts`
- ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆè¨­è¨ˆ: `docs/MULTI_DOMAIN_SETUP.md`

---

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:**
1. è¦ä»¶ã®æœ€çµ‚ç¢ºèªï¼ˆæ©Ÿèƒ½ç¯„å›²ã€å„ªå…ˆåº¦ï¼‰
2. å®Ÿè£…ã®æ®µéšçš„è¨ˆç”»ç­–å®š
3. Phase 1ã®å®Ÿè£…é–‹å§‹
4. E2Eãƒ†ã‚¹ãƒˆã®è¨­è¨ˆ
