# APPドメイン E2Eテスト仕様書

最終更新: 2025-10-18

## 📋 概要

APPドメイン（`app.local.test:3000`）は**一般ユーザー（member権限）向けのメインアプリケーション**です。組織内の業務機能を提供し、管理機能へのアクセスは制限されます。

## 🎯 テスト対象機能

### Phase 1: MVP（最小限の実装）

| 機能 | 説明 | 優先度 |
|------|------|--------|
| **ダッシュボード** | ログイン後の最初の画面、ウェルカムメッセージと基本情報 | 🔴 高 |
| **プロフィール設定** | ユーザー自身の名前、メールアドレス、パスワード変更 | 🔴 高 |
| **組織情報の閲覧** | 所属組織の名前、プラン、メンバー数の表示（編集不可） | 🟡 中 |

### Phase 2: 機能拡張（MVP後）

| 機能 | 説明 | 優先度 |
|------|------|--------|
| **組織切り替え** | 複数組織に所属している場合の切り替えUI | 🟡 中 |
| **メイン業務機能** | プロジェクト固有の業務機能（プロジェクトによって異なる） | 🔴 高 |

## 🧪 テストケース

---

### **1. ダッシュボード表示**

#### **1-1. member権限ユーザーのダッシュボードアクセス**

**前提条件:**
- テストアカウント: `member@example.com` / `test1234`
- 組織: Member Organization

**操作手順:**
1. WWWドメイン（`www.local.test:3000/login`）でログイン
2. APPドメイン（`app.local.test:3000`）に自動リダイレクト

**期待結果:**
- ✅ APPドメインのダッシュボードが表示される
- ✅ ウェルカムメッセージ「こんにちは、Member Userさん」が表示される
- ✅ 所属組織名「Member Organization」が表示される
- ✅ ヘッダーにユーザーメニューが表示される
- ✅ サイドバーまたはナビゲーションメニューが表示される

#### **1-2. 未認証ユーザーのAPPドメインアクセス**

**前提条件:**
- ログアウト状態

**操作手順:**
1. 直接APPドメイン（`app.local.test:3000`）にアクセス

**期待結果:**
- ✅ WWWログインページ（`www.local.test:3000/login`）にリダイレクト
- ✅ エラーメッセージは表示されない（自然なリダイレクト）

---

### **2. プロフィール設定**

#### **2-1. プロフィール情報の表示**

**前提条件:**
- テストアカウント: `member@example.com` / `test1234`
- APPドメインにログイン済み

**操作手順:**
1. ダッシュボードからプロフィール設定ページに移動
2. 現在のプロフィール情報を確認

**期待結果:**
- ✅ プロフィール設定ページが表示される
- ✅ 現在の名前「Member User」が表示される
- ✅ 現在のメールアドレス「member@example.com」が表示される
- ✅ パスワード変更フォームが表示される

#### **2-2. プロフィール情報の更新（名前変更）**

**前提条件:**
- テストアカウント: `member@example.com` / `test1234`
- プロフィール設定ページにアクセス済み

**操作手順:**
1. 名前フィールドを「Updated Member」に変更
2. 「保存」ボタンをクリック

**期待結果:**
- ✅ 成功メッセージ「プロフィールを更新しました」が表示される
- ✅ ページがリロードされ、新しい名前「Updated Member」が表示される
- ✅ ヘッダーのユーザー名も「Updated Member」に更新される

#### **2-3. パスワード変更**

**前提条件:**
- テストアカウント: `member@example.com` / `test1234`
- プロフィール設定ページにアクセス済み

**操作手順:**
1. 現在のパスワード「test1234」を入力
2. 新しいパスワード「newpass123」を入力
3. 新しいパスワード（確認）「newpass123」を入力
4. 「パスワードを変更」ボタンをクリック
5. ログアウトして、新しいパスワードでログイン

**期待結果:**
- ✅ 成功メッセージ「パスワードを変更しました」が表示される
- ✅ 新しいパスワード「newpass123」でログインできる
- ✅ 古いパスワード「test1234」ではログインできない

#### **2-4. パスワード変更エラー（現在のパスワードが間違っている）**

**前提条件:**
- テストアカウント: `member@example.com` / `test1234`
- プロフィール設定ページにアクセス済み

**操作手順:**
1. 現在のパスワードに間違った値「wrongpass」を入力
2. 新しいパスワード「newpass123」を入力
3. 新しいパスワード（確認）「newpass123」を入力
4. 「パスワードを変更」ボタンをクリック

**期待結果:**
- ✅ エラーメッセージ「現在のパスワードが正しくありません」が表示される
- ✅ パスワードは変更されない

---

### **3. 組織情報の閲覧**

#### **3-1. 所属組織情報の表示**

**前提条件:**
- テストアカウント: `member@example.com` / `test1234`
- APPドメインにログイン済み

**操作手順:**
1. ダッシュボードまたはナビゲーションから「組織情報」ページに移動

**期待結果:**
- ✅ 組織情報ページが表示される
- ✅ 組織名「Member Organization」が表示される
- ✅ 組織のスラッグ「member-org」が表示される
- ✅ 現在のプラン（例: Free / Pro / Enterprise）が表示される
- ✅ メンバー数（例: 1名）が表示される
- ✅ 編集ボタンは**表示されない**（member権限のため）

#### **3-2. member権限ユーザーが組織編集を試みる**

**前提条件:**
- テストアカウント: `member@example.com` / `test1234`
- APPドメインにログイン済み

**操作手順:**
1. 直接組織編集ページのURL（存在する場合）にアクセス

**期待結果:**
- ✅ エラーメッセージ「この操作を実行する権限がありません」が表示される
- ✅ または、ADMINドメインへのリンク「管理者に問い合わせてください」が表示される

---

## 👤 使用するテストアカウント

| メールアドレス | パスワード | 権限 | 組織 | 用途 |
|--------------|----------|------|------|------|
| `member@example.com` | `test1234` | member | Member Organization | 一般ユーザー機能のテスト |
| `noorg@example.com` | `test1234` | なし | なし | 組織未所属ユーザーのエラーケース |

## ⏰ 実装優先度

### **Phase 1: MVP（最優先）**

1. ✅ **ダッシュボード表示** - ログイン後の基本画面
2. ✅ **プロフィール設定** - 名前、メールアドレス、パスワード変更
3. ✅ **組織情報の閲覧** - 所属組織の基本情報表示

### **Phase 2: 機能拡張**

4. ⏳ **組織切り替え** - 複数組織対応（別仕様書で定義）
5. ⏳ **メイン業務機能** - プロジェクト固有の機能（プロジェクトによって異なる）

### **Phase 3: 利便性向上**

6. ⏳ **検索機能** - アプリケーション内の検索
7. ⏳ **通知機能** - リアルタイム通知（後回し）

---

## 📝 補足事項

### **権限の制限**

APPドメインは一般ユーザー（member権限）向けのため、以下の操作は**できません**：
- ❌ 組織情報の編集
- ❌ メンバーの招待・削除
- ❌ 権限の変更
- ❌ サブスクリプション管理
- ❌ 監査ログの閲覧

これらの操作は**ADMINドメイン**（owner/admin権限）でのみ可能です。

### **レイアウト設計**

- **ヘッダー**: 横並びナビゲーション + 組織切り替え（複数組織の場合） + ユーザーメニュー
- **デザイン**: モダンなグラデーション背景（青系）
- **特徴**: 一般ユーザー向けの親しみやすいデザイン

### **エラーハンドリング**

- 未認証ユーザー → WWWログインページにリダイレクト
- 組織未所属ユーザー → オンボーディングページにリダイレクト
- 権限不足 → エラーメッセージ + ADMIN問い合わせ案内

---

作成日: 2025-10-18
Next.js 15 + TypeScript + Supabase + マルチテナント
