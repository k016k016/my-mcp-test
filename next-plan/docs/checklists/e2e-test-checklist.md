E2Eテスト 作成チェックリスト（最終版）
この内容を満たさないE2EテストはPR禁止。
../patterns/e2e-testing.md と ../test-data/README.md を必ず参照すること。

==================================================
	1.	事前確認

⸻

1-1. ../patterns/e2e-testing.md を読んだか。
1-2. ../test-data/README.md（seedユーザ / 組織 / ロール / ownerの扱い）を確認したか。
1-3. 既存の e2e/helpers.ts を読んで、再利用できるものを把握したか。
1-4. シナリオを洗い出したか（成功系 / 失敗系 / 権限系）。

==================================================
2. ドメイン / URL のルール

2-1. localhost を使っていないか。必ずサブドメイン（.local.test等）を使っているか。
2-2. URLは .env.local の値を参照し、ハードコードしていないか。
2-3. .env.local の NEXT_PUBLIC_*_URL と NEXT_PUBLIC_COOKIE_DOMAIN の前提と一致しているか。

==================================================
3. アカウント / ロールの扱い

3-1. seed済みユーザを使っているか（例: test_user_*.example.com）。
3-2. 組織ロール（owner / admin / member）をテスト中に付け替えていないか。
3-3. ownerを外したり削除したりして、owner不在の組織を作っていないか（ownerは1組織に必ず存在する前提）。
3-4. ops用権限は組織ロールと別物として扱っているか（混ぜていないか）。

==================================================
	3.5.	認証バイパスの使い方

3.5-1. このテストは、ログイン手順を省略するためにADR-003で定義されたE2E専用バイパスを使っているか？
3.5-2. もしくはUIログインを正しく踏むテストそのものか？
3.5-3. 上記どちらでもない「middlewareを書き換えて権限付与しただけ」の疑似ログインになっていないか？（それは禁止）
3.5-4. E2E専用バイパスは本番・ステージング本番相当では無効であることを理解しているか？
3.5-5. 独自の抜け道（middleware緩和/RLS無効化/if (TEST) { return admin }）を使っていないか？

サインアップフローだけの例外ルール：
3-5. そのテストは「サインアップ機能そのもの」の挙動確認になっているか。（それ以外のテストでは新規登録しない）
3-6. 新規ユーザのメールは毎回ユニークか（形式: e2e+<yyyyMMddHHmmss>@example.com）。
3-7. 既存ユーザをDELETEして再利用しようとしていないか。（削除でリセットするな）

==================================================
4. 要素の取得方法

4-1. 要素はアクセシビリティで取得しているか。例: getByRole('button', { name: '保存' })。
4-2. CSSクラスや nth-child のような構造依存セレクタを使っていないか。
4-3. data-testid は他が無理な場合だけにしているか。

==================================================
5. ページ遷移と待機

5-1. page.goto() の直後に domcontentloaded まで待っているか。
5-2. 遷移を伴うクリックでは Promise.all([... waitForURL ..., click ...]) などでURL遷移とクリックを同期させているか。
5-3. URLの確認で toHaveURL(...) など明示の待機を入れているか。
5-4. Firefox / WebKit でも落ちない書き方にしているか（Chromium専用のタイミング依存にしていないか）。

==================================================
6. ダイアログ処理

6-1. 確認ダイアログは「クリック前」に page.once('dialog', ...) を登録しているか。
6-2. クリック後に dialog ハンドラを付けるような遅い書き方をしていないか。

==================================================
7. 遅延初期化コンポーネント

7-1. Monaco Editor のような遅延初期化UIは、使う前に初期化完了を待っているか。
例: window.monaco が初期化済みかチェックしてから操作しているか。

==================================================
8. タイムアウト

8-1. 非同期UIの検証は十分なタイムアウト（15〜20秒）を入れているか。
8-2. 即時の toBeVisible() / toBeEnabled() だけに頼っていないか。

==================================================
9. データとリセット

9-1. seed済みユーザや組織を DELETE していないか。
9-2. DB全体を TRUNCATE / DROP / migrationやり直し などで吹き飛ばしていないか。
9-3. 必要なら scripts/reset-e2e-db.ts（公式スクリプト想定）で初期化する前提にしているか。
9-4. 動的ユーザ（e2e+timestamp@example.com）の再利用で409を起こさないようにしているか。

==================================================
10. 最終チェック

10-1. テスト名は「<ドメイン> - <機能> › <シナリオ> › <期待される結果>」の形式になっているか。
10-2. ローカルで3回連続成功したか。
10-3. CIでも成功したか。
10-4. どのseedユーザ / どのドメイン / どの権限を前提にしているかを記録したか。

==================================================
11. 却下対象になるテスト

11-1. ロール昇格やowner剥奪など、仕様をねじ曲げて通すテスト。
11-2. owner不在の組織状態をわざと作るテスト。
11-3. localhost 前提のテスト。
11-4. CSSセレクタ依存のテスト。
11-5. Firefox / WebKit での待機を考慮していないテスト。
11-6. 既存ユーザや組織をDELETEして”初期化”するテスト。
11-7. DBをTRUNCATE/DROPで吹き飛ばすテスト。