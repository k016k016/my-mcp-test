# 機能名: 組織切り替え (organization switching)

## 概要
ユーザーが所属している複数の組織の中から、現在アクティブな組織を切り替えるUIとサーバ処理。
切り替え後は、その組織の `organization_id` がアプリ全体のコンテキストになる。

## 前提
- 1ユーザーは複数組織に所属できる。
- 組織には必ず `owner` がいる。`owner` がいない組織は無効として扱う（仕様外の状態は作らない）。
- 現在の組織IDはサーバー側セッションとCookieで保持される。middleware.tsはこの前提で動くので、勝手に挙動を変えないこと。

## 正常系フロー
1. ユーザーが「組織を切り替える」UIを開く。
2. 所属している組織一覧が表示される（表示順ルールがあるならここで定義する）。
3. ユーザーが組織Aを選択する。
4. Server Actionがその組織IDを現在組織としてセットする。
5. Server Actionは `ActionResult` を返す。サーバー側で `redirect()` はしない。
6. クライアント側が `nextUrl` を受け取り、`router.push()` または `location.assign()` で遷移する。

## 権限制御
- `member` でも組織の切り替え自体は可能。
- ただし遷移先（例: 管理用UIなど）にアクセス権がない場合は成功扱いにしない。
- そのときのServer Action戻り値の例：

~~~ts
return {
  success: false,
  error: 'この組織にはアクセス権がありません',
  nextUrl: '/unauthorized'
}
~~~

※ `redirect()` は禁止。`nextUrl` だけ返す。

## 禁止事項 / 境界
- ユーザーが所属していない `organization_id` を指定しても切り替わらないこと。チェックを省略しない。
- `owner` を削除して「owner不在の組織」をE2Eで再現しようとしない。それは仕様外扱い。
- ロールを勝手に昇格させて「とりあえず全部見えるようにしました」というテストはNG。
- middleware.ts側（セッション・ドメイン判定・リダイレクト条件）を「テスト通らないから簡略化します」という提案もNG。