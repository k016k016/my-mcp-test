# Next Plan - プロジェクト開発テンプレート

## 📌 このフォルダについて

このディレクトリは、**新しいプロジェクトで即座に使える、ドキュメント駆動開発のテンプレート**です。

### 🎯 このテンプレートの目的

**「学びを習慣にする」仕組み**を提供します：

1. **実装前に必ずパターンを確認**させる
2. **チェックリストで抜け漏れを防ぐ**
3. **決定の背景を記録**し、同じ議論を繰り返さない
4. **トラブルを素早く解決**できるガイドを提供

### 💡 なぜこのテンプレートが必要か

多くのプロジェクトで、以下の問題が繰り返されます：

1. **同じ失敗を繰り返す**
   - 実装ログに素晴らしい知見が蓄積されているが、新規実装時に参照されない
   - 同じ問題を複数回解決してしまう

2. **パターンが散在**
   - ドキュメント、コメント、実装ログに知見が分散
   - 統一されたパターンカタログがない

3. **実装前のガイダンスがない**
   - TDDやセキュリティチェックを忘れる
   - 後付けで追加する羽目になる

4. **テストデータ管理が行き当たりばったり**
   - 必要になった時に追加
   - 体系的な設計がない

このテンプレートは、これらの問題を**プロジェクトの最初から予防**します。

---

## 📁 ディレクトリ構造

```
next-plan/
├── README.md                           # このファイル
│
├── patterns/                           # 実装パターンカタログ
│   ├── README.md                       # パターン一覧と使い方
│   ├── server-actions.md               # Server Actions設計パターン
│   ├── e2e-testing.md                  # E2Eテスト安定化パターン
│   └── multi-domain.md                 # マルチドメイン環境パターン
│
├── checklists/                         # 実装前・実装後チェックリスト
│   ├── pre-implementation.md           # 実装開始前のチェック項目
│   ├── server-action-checklist.md      # Server Action実装時
│   └── e2e-test-checklist.md           # E2Eテスト作成時
│
├── test-data/                          # テストデータ設計
│   ├── README.md                       # テストデータ全体設計
│   └── e2e-users.md                    # E2Eユーザーマトリクス
│
├── decisions/                          # ADR（Architecture Decision Records）
│   ├── README.md                       # ADRの説明とテンプレート
│   ├── 001-multi-domain-architecture.md
│   └── 003-e2e-auth-bypass.md
│
└── troubleshooting/                    # トラブルシューティング
    ├── README.md                       # トラブルシューティング一覧
    └── server-action-redirect.md       # redirect()問題と解決策
```

---

## 🚀 新プロジェクトでの使い方

### ステップ1: Next.jsプロジェクトを作成

```bash
# 新しいプロジェクトを作成
mkdir my-new-project
cd my-new-project

# Next.jsプロジェクトを初期化
npx create-next-app@latest . --typescript --tailwind --app
```

### ステップ2: このテンプレートをdocs/にリネーム

```bash
# このディレクトリ自体をdocs/にリネーム
mv next-plan docs

# プロジェクト構造:
# my-new-project/
# ├── docs/              # このテンプレートの内容
# │   ├── patterns/
# │   ├── checklists/
# │   ├── decisions/
# │   ├── troubleshooting/
# │   └── test-data/
# ├── app/               # Next.jsアプリ
# ├── components/
# ├── CLAUDE.md
# └── ...
```

### ステップ3: サンプルADRの処理

```bash
# docs/decisions/内のサンプルADRを確認
# - 参考になる場合は残す
# - 不要な場合は削除して、プロジェクト固有のADRを追加
```

### ステップ4: プロジェクト固有の設定

1. **docs/patterns/** - プロジェクトに応じてパターンを追加/削除
2. **docs/test-data/** - プロジェクトのテストユーザー設計を記述
3. **docs/checklists/** - プロジェクト固有のチェック項目を追加

### ステップ5: CLAUDE.mdとの連携

プロジェクトルートに`CLAUDE.md`を作成し、このテンプレートへのリンクを追加：

```markdown
# CLAUDE.md

## 重要なルール

### 実装前の確認

新機能を実装する前に、以下を確認してください：

1. **[実装前チェックリスト](./docs/checklists/pre-implementation.md)** を実施
2. **[パターンカタログ](./docs/patterns/README.md)** で関連パターンを確認
3. **[テストデータ設計](./docs/test-data/README.md)** を確認
```

---

## 📝 日常的な使い方

### 新機能を実装する前に

1. **[実装前チェックリスト](./checklists/pre-implementation.md)** を実施
2. **[パターンカタログ](./patterns/README.md)** で関連パターンを確認
3. **[テストデータ設計](./test-data/e2e-users.md)** で利用可能なテストユーザーを確認

### 実装中

4. **TDDサイクル**（Red-Green-Refactor）で進める
5. **該当するチェックリスト**（例: [Server Action](./checklists/server-action-checklist.md)）を実行

### 実装後

6. 新しいパターンを発見したら**パターンカタログを更新**
7. 重要な設計判断をしたら**ADRを記録**
8. 実装ログに記録

### トラブル時

9. **[トラブルシューティング](./troubleshooting/README.md)** で既知の問題を検索
10. 解決したらトラブルシューティングに追加

---

## 📊 このテンプレートの効果

### 1. 問題の再発防止
- ✅ 同じ問題を2回解決することがなくなる
- ✅ パターン化された解決策が即座に適用できる
- ✅ トラブルシューティングで素早く解決

### 2. 実装品質の向上
- ✅ TDDを忘れない（チェックリスト）
- ✅ セキュリティチェックを省略しない
- ✅ 設計判断が後回しにならない

### 3. 学習効率の向上
- ✅ 新しいメンバー（または未来の自分）がパターンから学べる
- ✅ 「なぜ」が分かる（ADR）
- ✅ 迷わない（テストデータ設計、チェックリスト）

### 4. Claude Codeとの相性
- ✅ 必要なパターンだけ読む（トークン効率）
- ✅ 実装前にチェックリストを確認
- ✅ 実装ログは検索用（日常的には読まない）

---

## 🔄 運用方法

### 継続的な改善

1. **パターンの追加**: 新しい知見が得られたらパターンカタログに追加
2. **チェックリストの改善**: 抜け漏れがあればチェック項目を追加
3. **トラブルシューティングの充実**: 新しい問題が発生したら追加
4. **ADRの記録**: 重要な設計判断は必ず記録

### プロジェクト間での共有

- このテンプレートは**複数のプロジェクトで使い回せる**設計
- プロジェクト固有の内容は`decisions/`と`test-data/`のみ
- `patterns/`と`checklists/`は汎用的

---

## 🎯 最終目標

**「同じ失敗を繰り返さず、過去の学びを確実に適用できる」状態を実現する**

このテンプレートが、その一助となれば幸いです。

---

## 📚 参考: このテンプレートが生まれた背景

このテンプレートは、実際のプロジェクトで以下の問題に直面した経験から生まれました：

- Server Action redirect()問題を2回解決（2025-01-24と2025-10-25）
- E2Eテストの不安定性を何度も修正
- TDDを忘れて後からテスト追加
- テストデータ設計が行き当たりばったり

これらの**反省を活かし、次のプロジェクトでは同じ過ちを繰り返さない**ために作成されました。

`decisions/`内のサンプルADRは、実際のプロジェクトで下した判断の記録です。参考にしてください。
